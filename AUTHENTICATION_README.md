# Реализация системы аутентификации в Flutter-проекте Monex

## Описание реализации

В проект добавлена полнофункциональная система регистрации и входа пользователей с безопасным хранением паролей.

## Добавленные компоненты

### 1. Зависимости (pubspec.yaml)
- **shared_preferences** ^2.2.2 - для локального хранения данных пользователя
- **crypto** ^3.0.3 - для хэширования паролей по алгоритму SHA-256

### 2. AuthService (lib/services/auth_service.dart)

Основной сервис для управления аутентификацией пользователей.

**Методы:**

```dart
// Регистрирует нового пользователя
static Future<bool> register({
  required String username,
  required String password,
})

// Аутентифицирует пользователя
static Future<bool> login({
  required String username,
  required String password,
})

// Проверяет авторизацию пользователя
static Future<bool> isLoggedIn()

// Получает текущего авторизованного пользователя
static Future<String?> getCurrentUser()

// Выходит из системы
static Future<void> logout()
```

**Особенности:**
- Логины хранятся в открытом виде
- Пароли хранятся только в хэшированном виде (SHA-256)
- Исходный пароль никогда не сохраняется
- Предотвращение повторной регистрации с тем же логином
- Все данные хранятся локально в SharedPreferences

### 3. Экран входа (lib/widgets/pages/login_page.dart)

**Функционал:**
- Поле для ввода логина
- Поле для ввода пароля (скрытое)
- Кнопка "Войти"
- Ссылка на регистрацию
- Обработка ошибок с отображением сообщений
- Индикатор загрузки во время входа

**Валидация:**
- Проверка заполнения обоих полей
- Сравнение хэша пароля с сохраненным значением
- Отображение понятного сообщения об ошибке при неверных данных

**Навигация:**
- При успешном входе - переход на HomeScreen
- Ссылка на страницу регистрации для новых пользователей

### 4. Экран регистрации (lib/widgets/pages/register_page.dart)

**Функционал:**
- Поле для ввода логина
- Поле для ввода пароля (скрытое)
- Поле для подтверждения пароля (скрытое)
- Кнопка "Зарегистрироваться"
- Ссылка на вход для существующих пользователей
- Обработка ошибок с отображением сообщений
- Индикатор загрузки во время регистрации

**Валидация:**
- Проверка заполнения всех полей
- Проверка минимальной длины пароля (6 символов)
- Проверка совпадения пароля и подтверждения
- Проверка уникальности логина
- Отображение понятных сообщений об ошибках

**Навигация:**
- При успешной регистрации - возврат на экран входа с уведомлением
- Ссылка на экран входа при наличии учетной записи

### 5. Главный экран (lib/widgets/pages/home_page.dart)

**Добавленная функциональность:**
- Кнопка выхода в меню AppBar (PopupMenuButton)
- При выборе "Выход" - очистка сессии и возврат на экран входа
- Сохранение основной функциональности приложения

### 6. Модифицированный main.dart

**Навигация приложения:**
- Проверка статуса авторизации при запуске приложения
- Если пользователь авторизован - отображение HomeScreen
- Если пользователь не авторизован - отображение LoginScreen
- Использование FutureBuilder для асинхронной проверки

## Логика работы

### Регистрация:
1. Пользователь вводит логин и пароль
2. Проводится валидация данных
3. Проверяется уникальность логина
4. Пароль хэшируется функцией SHA-256
5. Логин и хэш пароля сохраняются в SharedPreferences
6. Пользователь получает уведомление об успехе
7. Возврат на экран входа

### Вход:
1. Пользователь вводит логин и пароль
2. Проводится валидация данных
3. Проверяется наличие пользователя в системе
4. Пароль хэшируется функцией SHA-256
5. Хэш сравнивается с сохраненным значением
6. При совпадении - сохранение текущего пользователя в SharedPreferences
7. Переход на главный экран приложения

### Выход:
1. Пользователь нажимает кнопку "Выход" в меню
2. Очищается значение текущего пользователя из SharedPreferences
3. Выполняется переход на экран входа

## Хранение данных в SharedPreferences

**Формат хранения:**
```
users: {"user1":"hash1","user2":"hash2",...}
current_user: "current_username"
```

**Безопасность:**
- Логины хранятся в открытом виде (необходимо для поиска пользователя)
- Пароли хранятся только в виде хэша SHA-256
- Исходный пароль не может быть восстановлен из хэша
- При входе проводится сравнение хэшей, а не паролей

## Тестирование

### Тестовые сценарии:

**Регистрация:**
- ✓ Регистрация с валидными данными
- ✓ Попытка зарегистрировать существующий логин (должна быть ошибка)
- ✓ Регистрация с коротким паролем (менее 6 символов - ошибка)
- ✓ Регистрация с несовпадающими паролями (ошибка)
- ✓ Попытка регистрации с пустыми полями (ошибка)

**Вход:**
- ✓ Вход с правильными данными
- ✓ Попытка входа с неправильным паролем (ошибка)
- ✓ Попытка входа с несуществующим логином (ошибка)
- ✓ Попытка входа с пустыми полями (ошибка)

**Общее:**
- ✓ Проверка сохранения сессии после перезапуска приложения
- ✓ Проверка выхода и очистки сессии
- ✓ Проверка навигации между экранами

## Структура файлов

```
lib/
├── main.dart (обновлен)
├── services/
│   ├── auth_service.dart (новый)
│   └── currency_service.dart
├── widgets/
│   └── pages/
│       ├── login_page.dart (новый)
│       ├── register_page.dart (новый)
│       └── home_page.dart (обновлен)
└── ... (другие файлы)
```

## Требования выполнены

✅ **Экран регистрации:**
- Поле логина
- Поле пароля
- Кнопка «Зарегистрироваться»

✅ **Экран входа:**
- Поле логина
- Поле пароля
- Кнопка «Войти»

✅ **Хранение данных:**
- Использован пакет shared_preferences
- Логины хранятся в открытом виде
- Пароли хранятся только в хэшированном виде (SHA-256)
- Исходный пароль не сохраняется

✅ **Хэширование пароля:**
- Пароль хэшируется перед сохранением
- При входе вводимый пароль хэшируется
- Сравниваются хэши для проверки

✅ **Логика работы:**
- Предотвращение повторной регистрации с существующим логином
- Показание ошибок при неверных логине или пароле
- Успешный вход переводит на основной экран приложения
